%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% PREAMBULE        
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

\documentclass[a4,12pt]{article}

% --- Packages génériques ---%

\usepackage[francais]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[babel=true]{csquotes}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{float}
\usepackage{graphicx}
\usepackage{hyperref}

% --- Structure de la page ---%

\usepackage{fancyheadings}

\topmargin -1.5 cm
\oddsidemargin -0.5 cm
\evensidemargin -0.5 cm
\textwidth 17 cm
\setlength{\headwidth}{\textwidth}
\textheight 24 cm
\pagestyle{fancy}
\lhead[\fancyplain{}{\thepage}]{\fancyplain{}{\sl ENSIMAG 2A}}
\chead[\fancyplain{}{{\sl }}]{\fancyplain{}{{C++ - TP1}}}
\rhead[\fancyplain{}{}]{\fancyplain{}{Julien Bordas}}
\lfoot{\fancyplain{}{}}
\cfoot{\fancyplain{}{}}
\cfoot{\thepage }
\rfoot{\fancyplain{}{}}

% --- Style de la zone de code ---%

\usepackage{tikz}
\usetikzlibrary{calc}
\usepackage[framemethod=tikz]{mdframed}
\usepackage{listings}             
\usepackage{textcomp}

\lstset{upquote=true,
  columns=flexible,
  keepspaces=true,
  breaklines,
  breakindent=0pt,
  basicstyle=\ttfamily,
  commentstyle=\color[rgb]{0,0.6,0},
  language=Scilab,
  alsoletter=\),
}

\lstset{classoffset=0,
  keywordstyle=\color{violet!75},
  deletekeywords={zeros,disp},
  classoffset=1,
  keywordstyle=\color{cyan},
  morekeywords={zeros,disp},
}

\lstset{extendedchars=true,
  literate={0}{{\color{brown!75}0}}1 
  {1}{{\color{brown!75}1}}1 
  {2}{{\color{brown!75}2}}1 
  {3}{{\color{brown!75}3}}1 
  {4}{{\color{brown!75}4}}1 
  {5}{{\color{brown!75}5}}1 
  {6}{{\color{brown!75}6}}1 
  {7}{{\color{brown!75}7}}1 
  {8}{{\color{brown!75}8}}1 
  {9}{{\color{brown!75}9}}1 
  {(}{{\color{blue!50}(}}1 
  {)}{{\color{blue!50})}}1 
  {[}{{\color{blue!50}[}}1 
  {]}{{\color{blue!50}]}}1
  {-}{{\color{gray}-}}1
  {+}{{\color{gray}+}}1
  {=}{{\color{gray}=}}1
  {:}{{\color{orange!50!yellow}:}}1
  {é}{{\'e}}1 
  {è}{{\`e}}1 
  {à}{{\`a}}1 
  {ç}{{\c{c}}}1 
  {œ}{{\oe}}1 
  {ù}{{\`u}}1
  {É}{{\'E}}1 
  {È}{{\`E}}1 
  {À}{{\`A}}1 
  {Ç}{{\c{C}}}1 
  {Œ}{{\OE}}1 
  {Ê}{{\^E}}1
  {ê}{{\^e}}1 
  {î}{{\^i}}1 
  {ô}{{\^o}}1 
  {û}{{\^u}}1 
}

\lstset { %
    language=C++,
    backgroundcolor=\color{black!5}, % set backgroundcolor
    basicstyle=\footnotesize,% basic font setting
}

% --- Raccourcis commande ---%

\newcommand{\R}{\mathbb{R}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\A}{\mathbf{A}}
\newcommand{\B}{\mathbf{B}}
\newcommand{\C}{\mathbf{C}}
\newcommand{\D}{\mathbf{D}}
\newcommand{\ub}{\mathbf{u}}

% --- Mode correction et incréments automatiques ---%

\usepackage{framed}
\usepackage{ifthen}
\usepackage{comment}

\newcounter{question}

\newcommand*\question{%
  \stepcounter{question}%
  \textbf{Question \thequestion. }}

\newboolean{enseignant}
\setboolean{enseignant}{true}
% \setboolean{enseignant}{false}

\definecolor{shadecolor}{gray}{0.80}

\ifthenelse{
  \boolean{enseignant}}{
  \newenvironment{correction}{\begin{shaded}}{\end{shaded}}
}
{
  \excludecomment{correction}
}

% --- Style de l'encadré des questions ---%

\mdfsetup{leftmargin=12pt}
\mdfsetup{skipabove=\topskip,skipbelow=\topskip}

\tikzset{
  warningsymbol/.style={
    rectangle,draw=red,
    fill=white,scale=1,
    overlay}}
\global\mdfdefinestyle{exampledefault}{
  hidealllines=true,leftline=true,
  innerrightmargin=0.0em,
  innerleftmargin=0.3em,
  leftmargin=0.0em,
  linecolor=red,
  backgroundcolor=orange!20,
  middlelinewidth=4pt,
  innertopmargin=\topskip,
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% EN-TETE        
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

\title{\textbf{Projet Modélisation en C++ \\ TP1}}
\author{
  \begin{tabular}{cc}
    \textsc{Julien BORDAS}
  \end{tabular}}   
\date{\small Février 2017}

\makeatletter
\def\thetitle{\@title}
\def\theauthor{\@author}
\def\thedate{\@date}
\makeatother 

\usepackage{etoolbox}
\usepackage{titling}
\setlength{\droptitle}{-7em}

\setlength{\parindent}{0cm}

\makeatletter
% patch pour le bug concernant les parenthèses fermantes d'après http://tex.stackexchange.com/q/69472
\patchcmd{\lsthk@SelectCharTable}{%
  \lst@ifbreaklines\lst@Def{`)}{\lst@breakProcessOther)}\fi}{}{}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% CORPS DU DOCUMENT          
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

\begin{document}
\maketitle

\begin{mdframed}[style=exampledefault]
    \question
\end{mdframed}

\begin{shaded}
    
    \begin{lstlisting}
    Dvector x;
    x = Dvector(3, 1.);\end{lstlisting}
    Dans cette écriture, l'utilisateur fait appel à l'opérateur \text{=}.\\
    Tant que ce dernier ne sera pas surchargé, ce code ne s'exécutera pas !\\

    \begin{lstlisting}
    Dvector x = Dvector(3, 1.);\end{lstlisting}
    Dans cette écriture, l'utilisateur fait appel au constructeur par recopie qui, lui, est défini dans le code.

\end{shaded}

\begin{mdframed}[style=exampledefault]
    \question
\end{mdframed}

\begin{shaded}
    
    \begin{lstlisting}
    std::stringstream str1;
    Dvector v1;
    assert(&v1 != NULL);
    std::cout << "# OK : v1 n'est pas NULL\n";
    (&v1)->display(str1);
    assert(str1.str() == "");
    std::cout << "# OK : v1 est vide et v1.display() n'a rien affiché\n\n";\end{lstlisting}

\end{shaded}

\begin{mdframed}[style=exampledefault]
    \question
\end{mdframed}

\begin{shaded}
    
    OK

\end{shaded}
\newpage
\begin{mdframed}[style=exampledefault]
    \question
\end{mdframed}

\begin{shaded}
    
    ==21501== HEAP SUMMARY:\\
    ==21501==     in use at exit: 0 bytes in 0 blocks\\
    ==21501==   total heap usage: 18 allocs, 18 frees, 169,298 bytes allocated\\
    ==21501== \\
    ==21501== All heap blocks were freed -- no leaks are possible\\


\end{shaded}

\end{document}